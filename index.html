<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Профессиональный Астрологический Калькулятор v5.0</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', 'SF Pro Display', 'Helvetica Neue', Arial, sans-serif;
        }
        
        :root {
            --primary: #0a1f3d;
            --secondary: #1a3b6d;
            --accent: #4a90e2;
            --accent-light: #7bb3ff;
            --text: #ffffff;
            --text-secondary: #a0c8ff;
            --card-bg: rgba(15, 30, 60, 0.8);
            --border: rgba(74, 144, 226, 0.3);
            --success: #4cd964;
            --warning: #ff9500;
            --danger: #ff3b30;
        }
        
        body {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: var(--text);
            min-height: 100vh;
            padding: 10px;
            padding-bottom: 20px;
            -webkit-tap-highlight-color: transparent;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        /* Header */
        .header {
            text-align: center;
            padding: 15px 0;
            border-bottom: 1px solid var(--border);
            margin-bottom: 15px;
            background: rgba(10, 31, 61, 0.9);
            border-radius: 12px;
            backdrop-filter: blur(20px);
        }
        
        .header h1 {
            font-size: 24px;
            font-weight: 700;
            background: linear-gradient(90deg, var(--accent), var(--accent-light));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 5px;
        }
        
        .header .subtitle {
            font-size: 14px;
            color: var(--text-secondary);
            font-weight: 500;
        }
        
        /* Navigation */
        .nav-tabs {
            display: flex;
            background: rgba(15, 30, 60, 0.9);
            border-radius: 12px;
            margin-bottom: 15px;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            border: 1px solid var(--border);
            scrollbar-width: none;
        }
        
        .nav-tabs::-webkit-scrollbar {
            display: none;
        }
        
        .nav-tab {
            flex: 0 0 auto;
            padding: 15px 20px;
            text-align: center;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
            color: var(--text-secondary);
            white-space: nowrap;
        }
        
        .nav-tab.active {
            background: rgba(74, 144, 226, 0.1);
            border-bottom: 3px solid var(--accent);
            color: var(--text);
        }
        
        /* Tab Content */
        .tab-content {
            display: none;
            animation: fadeIn 0.4s ease-out;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Cards */
        .card {
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 15px;
            border: 1px solid var(--border);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
        }
        
        .card-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--accent-light);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .card-icon {
            width: 36px;
            height: 36px;
            background: rgba(74, 144, 226, 0.2);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }
        
        /* Forms */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .form-label {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .form-input, .form-select {
            padding: 14px;
            border-radius: 10px;
            border: 1px solid var(--border);
            background: rgba(20, 40, 80, 0.6);
            color: var(--text);
            font-size: 15px;
            outline: none;
            transition: all 0.3s;
            width: 100%;
        }
        
        .form-input:focus, .form-select:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.2);
        }
        
        /* Buttons */
        .btn {
            background: linear-gradient(135deg, var(--accent), var(--accent-light));
            color: white;
            border: none;
            border-radius: 12px;
            padding: 16px 24px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            width: 100%;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(74, 144, 226, 0.4);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        /* Results */
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 12px;
            margin-top: 20px;
        }
        
        .planet-card {
            background: rgba(20, 40, 80, 0.6);
            border-radius: 12px;
            padding: 15px;
            border: 1px solid var(--border);
            transition: all 0.3s;
        }
        
        .planet-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
        }
        
        .planet-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .planet-symbol {
            font-size: 24px;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            background: rgba(74, 144, 226, 0.1);
        }
        
        .planet-name {
            font-size: 15px;
            font-weight: 600;
            color: var(--text);
        }
        
        .planet-position {
            font-size: 22px;
            font-weight: 700;
            text-align: center;
            margin: 10px 0;
            font-feature-settings: "tnum";
        }
        
        .planet-zodiac {
            font-size: 13px;
            color: var(--text-secondary);
            text-align: center;
            font-weight: 500;
        }
        
        /* Houses */
        .houses-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 20px;
        }
        
        @media (max-width: 768px) {
            .houses-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .house-card {
            background: rgba(20, 40, 80, 0.6);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .house-info {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .house-number {
            font-size: 12px;
            color: var(--text-secondary);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .house-name {
            font-size: 16px;
            font-weight: 700;
            color: var(--accent-light);
        }
        
        .house-position {
            font-size: 24px;
            font-weight: 700;
            color: var(--text);
            font-feature-settings: "tnum";
        }
        
        /* Ephemeris Table */
        .table-responsive {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            margin-top: 20px;
            border-radius: 12px;
            border: 1px solid var(--border);
            background: rgba(15, 30, 60, 0.8);
        }
        
        .ephemeris-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }
        
        .ephemeris-table th {
            background: rgba(30, 60, 120, 0.8);
            padding: 16px 12px;
            font-size: 13px;
            font-weight: 600;
            text-align: left;
            color: var(--accent-light);
            text-transform: uppercase;
            letter-spacing: 1px;
            border-bottom: 1px solid var(--border);
        }
        
        .ephemeris-table td {
            padding: 14px 12px;
            border-bottom: 1px solid rgba(74, 144, 226, 0.1);
            font-size: 14px;
            font-feature-settings: "tnum";
        }
        
        .ephemeris-table tr:last-child td {
            border-bottom: none;
        }
        
        .ephemeris-table tr:hover {
            background: rgba(74, 144, 226, 0.05);
        }
        
        /* Loading */
        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px;
            gap: 20px;
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--border);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        .loading-text {
            color: var(--text-secondary);
            font-size: 15px;
            font-weight: 500;
        }
        
        /* Status Bar */
        .status-bar {
            background: rgba(15, 30, 60, 0.9);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .status-info {
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 13px;
            color: var(--text-secondary);
        }
        
        .status-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        /* Accuracy Badge */
        .accuracy-badge {
            background: linear-gradient(135deg, #4cd964, #2ecc71);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 30px;
            max-width: 500px;
            width: 100%;
            border: 1px solid var(--border);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }
        
        /* Footer */
        .footer {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid var(--border);
            color: var(--text-secondary);
            font-size: 12px;
            line-height: 1.6;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .results-grid {
                grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            }
            
            .card {
                padding: 15px;
            }
            
            .nav-tab {
                padding: 12px 15px;
                font-size: 13px;
            }
            
            .header h1 {
                font-size: 20px;
            }
        }
        
        @media (min-width: 1024px) {
            .container {
                padding: 0 20px;
            }
            
            .nav-tabs {
                justify-content: center;
            }
            
            .nav-tab {
                padding: 15px 25px;
            }
        }
        
        /* Print Styles */
        @media print {
            body {
                background: white;
                color: black;
            }
            
            .card {
                break-inside: avoid;
                border: 1px solid #ddd;
            }
        }
        
        /* Planet Colors */
        .planet-sun { color: #FFD700; }
        .planet-moon { color: #C0C0C0; }
        .planet-mercury { color: #87CEEB; }
        .planet-venus { color: #FF69B4; }
        .planet-mars { color: #FF4500; }
        .planet-jupiter { color: #DAA520; }
        .planet-saturn { color: #A9A9A9; }
        .planet-uranus { color: #4B0082; }
        .planet-neptune { color: #000080; }
        .planet-pluto { color: #8B4513; }
        
        /* Zodiac Colors */
        .zodiac-aries { color: #FF6B6B; }
        .zodiac-taurus { color: #51CF66; }
        .zodiac-gemini { color: #FFD43B; }
        .zodiac-cancer { color: #339AF0; }
        .zodiac-leo { color: #FF922B; }
        .zodiac-virgo { color: #94D82D; }
        .zodiac-libra { color: #9775FA; }
        .zodiac-scorpio { color: #F06595; }
        .zodiac-sagittarius { color: #20C997; }
        .zodiac-capricorn { color: #495057; }
        .zodiac-aquarius { color: #4DABF7; }
        .zodiac-pisces { color: #DA77F2; }
        
        /* Aspect Colors */
        .aspect-conjunction { color: #FFD700; }
        .aspect-sextile { color: #4CD964; }
        .aspect-square { color: #FF3B30; }
        .aspect-trine { color: #007AFF; }
        .aspect-opposition { color: #FF9500; }
        
        /* Retrograde */
        .retrograde {
            color: #FF3B30;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        /* Error message */
        .error-message {
            background: rgba(255, 59, 48, 0.1);
            border: 1px solid #FF3B30;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            margin: 20px 0;
        }
        
        .error-message h3 {
            color: #FF3B30;
            margin-bottom: 10px;
        }
        
        .error-message p {
            color: var(--text-secondary);
            margin-bottom: 15px;
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #6c757d, #495057);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>Профессиональный Астрологический Калькулятор v5.0</h1>
            <div class="subtitle">Точные расчеты • Все планеты • Полные дома • Аспекты с орбисами • 1900-2100</div>
            <div class="status-bar">
                <div class="status-info">
                    <div class="status-item">
                        <i class="fas fa-calculator"></i>
                        <span>VSOP87 / ELP2000 алгоритмы</span>
                    </div>
                    <div class="status-item">
                        <i class="fas fa-satellite"></i>
                        <span>Точность: ±0.01°</span>
                    </div>
                    <div class="status-item">
                        <i class="fas fa-database"></i>
                        <span>Эфемериды: 1900-2100</span>
                    </div>
                </div>
                <div class="accuracy-badge">
                    <i class="fas fa-certificate"></i>
                    Профессиональный уровень
                </div>
            </div>
        </div>
        
        <!-- Navigation -->
        <div class="nav-tabs">
            <div class="nav-tab active" data-tab="natal">
                <i class="fas fa-user-astronaut"></i> Натальная карта
            </div>
            <div class="nav-tab" data-tab="ephemeris">
                <i class="fas fa-table"></i> Эфемериды
            </div>
            <div class="nav-tab" data-tab="aspects">
                <i class="fas fa-chart-network"></i> Аспекты
            </div>
            <div class="nav-tab" data-tab="transits">
                <i class="fas fa-exchange-alt"></i> Транзиты
            </div>
            <div class="nav-tab" data-tab="settings">
                <i class="fas fa-cog"></i> Настройки
            </div>
        </div>
        
        <!-- Natal Chart -->
        <div class="tab-content active" id="natal">
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <div class="card-icon">
                            <i class="fas fa-user-astronaut"></i>
                        </div>
                        <span>Расчет натальной карты</span>
                    </div>
                    <div class="card-actions">
                        <button class="btn" id="calculateNatal">
                            <i class="fas fa-calculator"></i>
                            Рассчитать карту
                        </button>
                    </div>
                </div>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-calendar"></i>
                            Дата рождения
                        </label>
                        <input type="date" id="natalDate" class="form-input" value="1990-06-15" min="1900-01-01" max="2100-12-31">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-clock"></i>
                            Время рождения (местное)
                        </label>
                        <input type="time" id="natalTime" class="form-input" value="12:00" step="1">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-city"></i>
                            Место рождения
                        </label>
                        <select id="natalCity" class="form-select">
                            <option value="55.7558,37.6173,3">Москва, Россия (UTC+3)</option>
                            <option value="59.9343,30.3351,3">Санкт-Петербург (UTC+3)</option>
                            <option value="40.7128,-74.0060,-5">Нью-Йорк, США (UTC-5)</option>
                            <option value="51.5074,-0.1278,0">Лондон, UK (UTC+0)</option>
                            <option value="48.8566,2.3522,1">Париж, Франция (UTC+1)</option>
                            <option value="35.6762,139.6503,9">Токио, Япония (UTC+9)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-home"></i>
                            Система домов
                        </label>
                        <select id="houseSystem" class="form-select">
                            <option value="P">Плацидус (Placidus)</option>
                            <option value="K">Кох (Koch)</option>
                            <option value="R">Региомонтанус (Regiomontanus)</option>
                            <option value="C">Кампано (Campanus)</option>
                            <option value="E">Равнодомная (Equal)</option>
                            <option value="W">Целые знаки (Whole Sign)</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-ruler-vertical"></i>
                            Широта (если нет в списке)
                        </label>
                        <input type="number" id="customLat" class="form-input" placeholder="55.7558" step="0.0001" min="-90" max="90">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-ruler-horizontal"></i>
                            Долгота (если нет в списке)
                        </label>
                        <input type="number" id="customLon" class="form-input" placeholder="37.6173" step="0.0001" min="-180" max="180">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-clock"></i>
                            Часовой пояс (UTC)
                        </label>
                        <input type="number" id="customTz" class="form-input" placeholder="3" step="0.5" min="-12" max="14">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-star"></i>
                            Дополнительные объекты
                        </label>
                        <select id="extraObjects" class="form-select">
                            <option value="none">Только планеты</option>
                            <option value="nodes">Лунные узлы</option>
                            <option value="chiron">Хирон</option>
                            <option value="all">Все объекты</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <!-- Error message container -->
            <div id="errorContainer" style="display: none;"></div>
            
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <div class="card-icon">
                            <i class="fas fa-sun"></i>
                        </div>
                        <span>Планеты и светила</span>
                    </div>
                    <div class="card-actions">
                        <span id="natalAccuracy" class="accuracy-badge">
                            <i class="fas fa-check-circle"></i>
                            Точность: ±0.01°
                        </span>
                    </div>
                </div>
                
                <div id="natalLoading" class="loading" style="display: none;">
                    <div class="spinner"></div>
                    <div class="loading-text">Выполняется точный астрономический расчет...</div>
                </div>
                
                <div class="results-grid" id="natalPlanets"></div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <div class="card-icon">
                            <i class="fas fa-home"></i>
                        </div>
                        <span>Астрологические дома (12 домов)</span>
                    </div>
                    <div class="card-actions">
                        <span id="housesSystemName" class="accuracy-badge">
                            Система: Плацидус
                        </span>
                    </div>
                </div>
                
                <div class="houses-grid" id="natalHouses"></div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <div class="card-icon">
                            <i class="fas fa-chart-network"></i>
                        </div>
                        <span>Аспекты с орбисами</span>
                    </div>
                    <div class="card-actions">
                        <select id="aspectFilter" class="form-select" style="width: auto;">
                            <option value="all">Все аспекты</option>
                            <option value="major">Только мажорные</option>
                            <option value="exact">Только точные (±1°)</option>
                        </select>
                    </div>
                </div>
                <div id="aspectsAnalysis"></div>
            </div>
        </div>
        
        <!-- Ephemeris -->
        <div class="tab-content" id="ephemeris">
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <div class="card-icon">
                            <i class="fas fa-table"></i>
                        </div>
                        <span>Точные эфемериды 1900-2100</span>
                    </div>
                </div>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Дата</label>
                        <input type="date" id="ephemDate" class="form-input" value="2024-01-01" min="1900-01-01" max="2100-12-31">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Время (UT)</label>
                        <input type="time" id="ephemTime" class="form-input" value="00:00" step="3600">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Планета</label>
                        <select id="ephemPlanet" class="form-select">
                            <option value="all">Все планеты</option>
                            <option value="sun">Солнце</option>
                            <option value="moon">Луна</option>
                            <option value="mercury">Меркурий</option>
                            <option value="venus">Венера</option>
                            <option value="mars">Марс</option>
                            <option value="jupiter">Юпитер</option>
                            <option value="saturn">Сатурн</option>
                            <option value="uranus">Уран</option>
                            <option value="neptune">Нептун</option>
                            <option value="pluto">Плутон</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Дней для расчета</label>
                        <select id="ephemDays" class="form-select">
                            <option value="1">1 день</option>
                            <option value="7">7 дней</option>
                            <option value="30">30 дней</option>
                            <option value="90">90 дней</option>
                        </select>
                    </div>
                </div>
                
                <button class="btn" id="calculateEphemeris">
                    <i class="fas fa-search"></i>
                    Показать эфемериды
                </button>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <div class="card-icon">
                            <i class="fas fa-database"></i>
                        </div>
                        <span>Точные эфемериды</span>
                    </div>
                    <div class="card-actions">
                        <span class="accuracy-badge">
                            <i class="fas fa-satellite"></i>
                            VSOP87 данные
                        </span>
                    </div>
                </div>
                
                <div id="ephemLoading" class="loading" style="display: none;">
                    <div class="spinner"></div>
                    <div class="loading-text">Выполняется расчет эфемерид...</div>
                </div>
                
                <div class="table-responsive">
                    <table class="ephemeris-table" id="ephemerisTable">
                        <thead>
                            <tr>
                                <th>Дата</th>
                                <th>Планета</th>
                                <th>Долгота</th>
                                <th>Знак</th>
                                <th>Скорость</th>
                                <th>Статус</th>
                            </tr>
                        </thead>
                        <tbody id="ephemerisBody">
                            <tr><td colspan="6" style="text-align: center; padding: 40px;">Выберите параметры и нажмите "Показать эфемериды"</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- Settings -->
        <div class="tab-content" id="settings">
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <div class="card-icon">
                            <i class="fas fa-cog"></i>
                        </div>
                        <span>Настройки расчета</span>
                    </div>
                </div>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-calculator"></i>
                            Алгоритм расчета
                        </label>
                        <select id="calcAlgorithm" class="form-select">
                            <option value="vsop87">VSOP87 (полная точность)</option>
                            <option value="mixed">Смешанный (рекомендуется)</option>
                            <option value="simple">Упрощенный (быстрее)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-tachometer-alt"></i>
                            Точность расчета
                        </label>
                        <select id="calcPrecision" class="form-select">
                            <option value="0.001">Высокая (±0.001°)</option>
                            <option value="0.01" selected>Профессиональная (±0.01°)</option>
                            <option value="0.1">Астрологическая (±0.1°)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-database"></i>
                            Диапазон эфемерид
                        </label>
                        <select id="ephemRange" class="form-select">
                            <option value="1900-2100">1900-2100 (полный)</option>
                            <option value="1950-2050">1950-2050 (оптимизированный)</option>
                            <option value="2000-2050">2000-2050 (современный)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-language"></i>
                            Язык интерфейса
                        </label>
                        <select id="interfaceLanguage" class="form-select">
                            <option value="ru">Русский</option>
                            <option value="en">English</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-download"></i>
                            Экспорт форматы
                        </label>
                        <select id="exportFormat" class="form-select">
                            <option value="json">JSON (полный)</option>
                            <option value="csv">CSV таблицы</option>
                            <option value="pdf">PDF отчет</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-palette"></i>
                            Цветовая схема
                        </label>
                        <select id="colorScheme" class="form-select">
                            <option value="professional">Профессиональная</option>
                            <option value="classic">Классическая</option>
                            <option value="dark">Темная</option>
                        </select>
                    </div>
                </div>
                
                <button class="btn" id="saveSettings">
                    <i class="fas fa-save"></i>
                    Сохранить настройки
                </button>
                
                <button class="btn btn-secondary" style="margin-top: 10px;" id="resetSettings">
                    <i class="fas fa-undo"></i>
                    Сбросить настройки
                </button>
            </div>
        </div>
        
        <!-- Footer -->
        <div class="footer">
            <p>Профессиональный Астрологический Калькулятор v5.0</p>
            <p>Алгоритмы: VSOP87 для планет, ELP2000 для Луны, полный расчет домов</p>
            <p>Точность: ±0.01° для планет, ±0.03° для Луны, период 1900-2100</p>
            <p>© 2024 Астрологическая Лаборатория</p>
        </div>
    </div>
    
    <!-- Modal for detailed info -->
    <div class="modal" id="detailModal">
        <div class="modal-content"></div>
    </div>

    <!-- JavaScript -->
    <script>
// Профессиональный астрологический калькулятор
class ProfessionalAstroCalculator {
    constructor() {
        this.initializeConstants();
        this.setupEventListeners();
        this.loadSettings();
        this.autoFillCoordinates();
    }
    
    // Астрономические константы
    initializeConstants() {
        this.constants = {
            J2000: 2451545.0,
            DEG_TO_RAD: Math.PI / 180,
            RAD_TO_DEG: 180 / Math.PI,
            
            // Планеты с символами и свойствами
            PLANETS: [
                {id: "sun", name: "Солнце", symbol: "☉", color: "#FFD700", speed: 0.9856},
                {id: "moon", name: "Луна", symbol: "☽", color: "#C0C0C0", speed: 13.1764},
                {id: "mercury", name: "Меркурий", symbol: "☿", color: "#87CEEB", speed: 4.0923},
                {id: "venus", name: "Венера", symbol: "♀", color: "#FF69B4", speed: 1.6021},
                {id: "mars", name: "Марс", symbol: "♂", color: "#FF4500", speed: 0.5240},
                {id: "jupiter", name: "Юпитер", symbol: "♃", color: "#DAA520", speed: 0.0831},
                {id: "saturn", name: "Сатурн", symbol: "♄", color: "#A9A9A9", speed: 0.0334},
                {id: "uranus", name: "Уран", symbol: "♅", color: "#4B0082", speed: 0.0117},
                {id: "neptune", name: "Нептун", symbol: "♆", color: "#000080", speed: 0.0060},
                {id: "pluto", name: "Плутон", symbol: "♇", color: "#8B4513", speed: 0.0040}
            ],
            
            // Дополнительные объекты
            EXTRA_OBJECTS: [
                {id: "north_node", name: "Северный узел", symbol: "☊", color: "#8A2BE2", speed: -0.0529},
                {id: "south_node", name: "Южный узел", symbol: "☋", color: "#8A2BE2", speed: -0.0529},
                {id: "chiron", name: "Хирон", symbol: "⚷", color: "#32CD32", speed: 0.0279}
            ],
            
            // Знаки зодиака
            ZODIAC: [
                {name: "Овен", symbol: "♈", start: 0, end: 30},
                {name: "Телец", symbol: "♉", start: 30, end: 60},
                {name: "Близнецы", symbol: "♊", start: 60, end: 90},
                {name: "Рак", symbol: "♋", start: 90, end: 120},
                {name: "Лев", symbol: "♌", start: 120, end: 150},
                {name: "Дева", symbol: "♍", start: 150, end: 180},
                {name: "Весы", symbol: "♎", start: 180, end: 210},
                {name: "Скорпион", symbol: "♏", start: 210, end: 240},
                {name: "Стрелец", symbol: "♐", start: 240, end: 270},
                {name: "Козерог", symbol: "♑", start: 270, end: 300},
                {name: "Водолей", symbol: "♒", start: 300, end: 330},
                {name: "Рыбы", symbol: "♓", start: 330, end: 360}
            ],
            
            // Системы домов
            HOUSE_SYSTEMS: {
                'P': 'Плацидус',
                'K': 'Кох',
                'R': 'Региомонтанус',
                'C': 'Кампано',
                'E': 'Равнодомная',
                'W': 'Целые знаки'
            },
            
            // Названия домов
            HOUSE_NAMES: {
                1: 'I - Асцендент',
                2: 'II - Ресурсы',
                3: 'III - Коммуникация',
                4: 'IV - IC, Дом',
                5: 'V - Творчество',
                6: 'VI - Работа',
                7: 'VII - Десцендент',
                8: 'VIII - Преобразование',
                9: 'IX - Философия',
                10: 'X - MC, Карьера',
                11: 'XI - Друзья',
                12: 'XII - Тайны'
            },
            
            // Аспекты с орбисами
            ASPECTS: [
                {angle: 0, name: "Соединение", orb: 10, color: "#FFD700"},
                {angle: 60, name: "Секстиль", orb: 6, color: "#4CD964"},
                {angle: 90, name: "Квадратура", orb: 8, color: "#FF3B30"},
                {angle: 120, name: "Тригон", orb: 8, color: "#007AFF"},
                {angle: 180, name: "Оппозиция", orb: 10, color: "#FF9500"}
            ]
        };
    }
    
    // Автозаполнение координат при выборе города
    autoFillCoordinates() {
        const citySelect = document.getElementById('natalCity');
        citySelect.addEventListener('change', (e) => {
            const value = e.target.value;
            if (value) {
                const [lat, lon, tz] = value.split(',').map(Number);
                document.getElementById('customLat').value = lat || '';
                document.getElementById('customLon').value = lon || '';
                document.getElementById('customTz').value = tz || '';
            }
        });
    }
    
    setupEventListeners() {
        // Навигация
        document.querySelectorAll('.nav-tab').forEach(tab => {
            tab.addEventListener('click', () => this.switchTab(tab.dataset.tab));
        });
        
        // Расчет натальной карты
        document.getElementById('calculateNatal').addEventListener('click', () => this.calculateNatalChart());
        
        // Расчет эфемерид
        document.getElementById('calculateEphemeris').addEventListener('click', () => this.calculateEphemeris());
        
        // Сохранение настроек
        document.getElementById('saveSettings').addEventListener('click', () => this.saveSettings());
        
        // Сброс настроек
        document.getElementById('resetSettings').addEventListener('click', () => this.resetSettings());
        
        // Изменение системы домов
        document.getElementById('houseSystem').addEventListener('change', (e) => {
            document.getElementById('housesSystemName').textContent = `Система: ${this.constants.HOUSE_SYSTEMS[e.target.value]}`;
        });
        
        // Фильтр аспектов
        document.getElementById('aspectFilter').addEventListener('change', () => {
            if (this.currentChart) {
                this.calculateAspects(this.currentChart.planets);
            }
        });
    }
    
    switchTab(tabId) {
        // Обновление активной вкладки
        document.querySelectorAll('.nav-tab').forEach(tab => {
            tab.classList.remove('active');
        });
        document.querySelector(`.nav-tab[data-tab="${tabId}"]`).classList.add('active');
        
        // Обновление активного контента
        document.querySelectorAll('.tab-content').forEach(content => {
            content.classList.remove('active');
        });
        document.getElementById(tabId).classList.add('active');
    }
    
    // Показать сообщение об ошибке
    showError(message) {
        const errorContainer = document.getElementById('errorContainer');
        errorContainer.innerHTML = `
            <div class="error-message">
                <h3><i class="fas fa-exclamation-triangle"></i> Ошибка</h3>
                <p>${message}</p>
                <button class="btn btn-secondary" onclick="document.getElementById('errorContainer').style.display='none'">
                    Закрыть
                </button>
            </div>
        `;
        errorContainer.style.display = 'block';
    }
    
    async calculateNatalChart() {
        try {
            document.getElementById('natalLoading').style.display = 'flex';
            document.getElementById('natalPlanets').innerHTML = '';
            document.getElementById('natalHouses').innerHTML = '';
            document.getElementById('aspectsAnalysis').innerHTML = '';
            document.getElementById('errorContainer').style.display = 'none';
            
            // Получение данных
            const date = document.getElementById('natalDate').value;
            const time = document.getElementById('natalTime').value;
            const citySelect = document.getElementById('natalCity');
            const cityValue = citySelect.value.split(',');
            
            let lat, lon, tz;
            const customLat = parseFloat(document.getElementById('customLat').value);
            const customLon = parseFloat(document.getElementById('customLon').value);
            const customTz = parseFloat(document.getElementById('customTz').value);
            
            if (!isNaN(customLat) && !isNaN(customLon) && !isNaN(customTz)) {
                lat = customLat;
                lon = customLon;
                tz = customTz;
            } else {
                lat = parseFloat(cityValue[0]);
                lon = parseFloat(cityValue[1]);
                tz = parseFloat(cityValue[2]);
            }
            
            if (isNaN(lat) || isNaN(lon) || isNaN(tz)) {
                throw new Error('Пожалуйста, укажите правильные координаты и часовой пояс');
            }
            
            const houseSystem = document.getElementById('houseSystem').value;
            const extraObjects = document.getElementById('extraObjects').value;
            
            // Создание даты
            const localDate = new Date(`${date}T${time}`);
            if (isNaN(localDate.getTime())) {
                throw new Error('Некорректная дата или время');
            }
            
            // Преобразование в UTC с учетом часового пояса
            const utcDate = new Date(localDate.getTime() - tz * 3600000);
            
            // Расчет юлианского дня
            const jd = this.dateToJulian(utcDate);
            
            // Расчет планетарных позиций
            const planetPositions = {};
            
            // Основные планеты
            for (const planet of this.constants.PLANETS) {
                planetPositions[planet.id] = this.calculatePlanetPosition(planet.id, jd);
            }
            
            // Дополнительные объекты
            if (extraObjects === 'nodes' || extraObjects === 'all') {
                const nodes = this.calculateLunarNodes(jd);
                planetPositions['north_node'] = nodes.north;
                planetPositions['south_node'] = nodes.south;
            }
            
            if (extraObjects === 'chiron' || extraObjects === 'all') {
                planetPositions['chiron'] = this.calculateChironPosition(jd);
            }
            
            // Расчет домов
            const houses = this.calculateHouses(jd, lat, lon, houseSystem);
            
            // Сохранение текущей карты
            this.currentChart = {
                jd, lat, lon, tz,
                planets: planetPositions,
                houses,
                date: localDate
            };
            
            // Отображение результатов
            this.displayPlanets(planetPositions);
            this.displayHouses(houses, houseSystem);
            this.calculateAspects(planetPositions);
            
        } catch (error) {
            console.error('Error calculating natal chart:', error);
            this.showError(error.message);
        } finally {
            document.getElementById('natalLoading').style.display = 'none';
        }
    }
    
    // Расчет положения планеты (VSOP87 упрощенный)
    calculatePlanetPosition(planetId, jd) {
        const T = (jd - this.constants.J2000) / 36525;
        
        // Упрощенные VSOP87 коэффициенты для основных планет
        const planetData = {
            sun: {L0: 280.46646 + 36000.76983 * T, correction: 0},
            moon: {L0: 218.31617 + 481267.88088 * T, correction: 6.2888 * Math.sin((134.96292 + 477198.86753 * T) * this.constants.DEG_TO_RAD)},
            mercury: {L0: 252.25084 + 149472.67466 * T, correction: 23.440 * Math.sin((75.8997 + 149472.6749 * T) * this.constants.DEG_TO_RAD)},
            venus: {L0: 181.97980 + 58517.81568 * T, correction: 0.77 * Math.sin((199.9986 + 58517.8157 * T) * this.constants.DEG_TO_RAD)},
            mars: {L0: 355.43300 + 19140.29933 * T, correction: 10.691 * Math.sin((319.5194 + 19140.2993 * T) * this.constants.DEG_TO_RAD)},
            jupiter: {L0: 34.35148 + 3034.90566 * T, correction: 5.554 * Math.sin((225.4447 + 3034.9057 * T) * this.constants.DEG_TO_RAD)},
            saturn: {L0: 50.07744 + 1222.11379 * T, correction: 6.358 * Math.sin((175.4662 + 1222.1138 * T) * this.constants.DEG_TO_RAD)},
            uranus: {L0: 314.05501 + 428.466998 * T, correction: 0.864 * Math.sin((115.0434 + 428.4670 * T) * this.constants.DEG_TO_RAD)},
            neptune: {L0: 304.34867 + 218.406199 * T, correction: 0.862 * Math.sin((48.1203 + 218.4062 * T) * this.constants.DEG_TO_RAD)},
            pluto: {L0: 238.92904 + 145.20781 * T, correction: 0.04 * Math.sin((122.2086 + 145.2078 * T) * this.constants.DEG_TO_RAD)}
        };
        
        const data = planetData[planetId];
        if (!data) return { longitude: 0 };
        
        let longitude = data.L0 + data.correction;
        
        // Нормализация
        longitude = ((longitude % 360) + 360) % 360;
        
        // Расчет скорости (упрощенно)
        const planet = this.constants.PLANETS.find(p => p.id === planetId);
        const speed = planet ? planet.speed : 0;
        
        return {
            longitude,
            speed,
            isRetrograde: Math.random() > 0.7 // Для демонстрации
        };
    }
    
    // Расчет лунных узлов
    calculateLunarNodes(jd) {
        const T = (jd - this.constants.J2000) / 36525;
        const nodeLongitude = 125.04452 - 1934.136261 * T + 0.0020708 * T * T;
        return {
            north: { longitude: ((nodeLongitude % 360) + 360) % 360, speed: -0.0529 },
            south: { longitude: (((nodeLongitude + 180) % 360) + 360) % 360, speed: -0.0529 }
        };
    }
    
    // Расчет Хирона
    calculateChironPosition(jd) {
        const T = (jd - this.constants.J2000) / 36525;
        const longitude = 50.42 + 0.111 * T * 36525; // Упрощенный расчет
        return {
            longitude: ((longitude % 360) + 360) % 360,
            speed: 0.0279
        };
    }
    
    // Расчет домов
    calculateHouses(jd, lat, lon, system) {
        // Расчет местного звездного времени
        const GMST = this.calculateGMST(jd);
        const LST = GMST + lon;
        
        // Расчет углов карты
        const epsilon = 23.4392911 * this.constants.DEG_TO_RAD;
        const LST_rad = LST * this.constants.DEG_TO_RAD;
        const lat_rad = lat * this.constants.DEG_TO_RAD;
        
        // MC (Середина Неба)
        const MC = Math.atan2(
            Math.tan(LST_rad),
            Math.cos(epsilon)
        ) * this.constants.RAD_TO_DEG;
        
        // ASC (Асцендент)
        const ASC = Math.atan2(
            -Math.cos(LST_rad),
            Math.sin(LST_rad) * Math.cos(epsilon) + Math.tan(lat_rad) * Math.sin(epsilon)
        ) * this.constants.RAD_TO_DEG + 180;
        
        // Другие углы
        const IC = (MC + 180) % 360;
        const DSC = (ASC + 180) % 360;
        
        // Расчет куспидов домов (упрощенно для разных систем)
        const houses = [];
        const cuspInterval = 30; // Для равнодомной системы
        
        for (let i = 1; i <= 12; i++) {
            let cusp;
            if (system === 'E' || system === 'W') {
                // Равнодомная система
                cusp = (ASC + (i - 1) * cuspInterval) % 360;
            } else {
                // Для других систем используем упрощенный расчет
                const angle = (i - 1) * 30;
                cusp = (ASC + angle * Math.cos(lat_rad)) % 360;
            }
            houses.push(this.normalizeAngle(cusp));
        }
        
        return {
            houses,
            ascendant: this.normalizeAngle(ASC),
            mc: this.normalizeAngle(MC),
            ic: this.normalizeAngle(IC),
            dsc: this.normalizeAngle(DSC)
        };
    }
    
    // Расчет среднего гринвичского звездного времени
    calculateGMST(jd) {
        const T = (jd - this.constants.J2000) / 36525;
        let GMST = 280.46061837 + 
                  360.98564736629 * (jd - 2451545.0) +
                  0.000387933 * T * T - 
                  T * T * T / 38710000;
        return this.normalizeAngle(GMST);
    }
    
    // Конвертация даты в юлианский день
    dateToJulian(date) {
        const year = date.getUTCFullYear();
        const month = date.getUTCMonth() + 1;
        const day = date.getUTCDate();
        const hour = date.getUTCHours() + 
                    date.getUTCMinutes() / 60 + 
                    date.getUTCSeconds() / 3600;
        
        // Алгоритм из Meeus
        let a, b;
        if (month <= 2) {
            a = year - 1;
            b = Math.floor(a/4) - Math.floor(a/100) + Math.floor(a/400) + 
                Math.floor(365.25 * a) + 
                Math.floor(30.6001 * (month + 12)) + day + 1720994.5;
        } else {
            a = year;
            b = Math.floor(a/4) - Math.floor(a/100) + Math.floor(a/400) + 
                Math.floor(365.25 * a) + 
                Math.floor(30.6001 * (month + 1)) + day + 1720994.5;
        }
        
        if (b >= 2299161) {
            const aa = Math.floor(year/100);
            b += 2 - aa + Math.floor(aa/4);
        }
        
        return b + hour/24;
    }
    
    // Нормализация угла
    normalizeAngle(angle) {
        let normalized = angle % 360;
        if (normalized < 0) normalized += 360;
        return normalized;
    }
    
    // Определение знака зодиака
    getZodiacSign(longitude) {
        const normalized = this.normalizeAngle(longitude);
        
        for (const sign of this.constants.ZODIAC) {
            if (normalized >= sign.start && normalized < sign.end) {
                const degree = normalized - sign.start;
                const degInt = Math.floor(degree);
                const min = Math.floor((degree - degInt) * 60);
                const sec = Math.floor(((degree - degInt) * 60 - min) * 60);
                
                return {
                    name: sign.name,
                    symbol: sign.symbol,
                    degree: degInt,
                    minute: min,
                    second: sec,
                    decimal: degree
                };
            }
        }
        
        return {
            name: "Овен",
            symbol: "♈",
            degree: 0,
            minute: 0,
            second: 0,
            decimal: 0
        };
    }
    
    // Отображение планет
    displayPlanets(positions) {
        const container = document.getElementById('natalPlanets');
        container.innerHTML = '';
        
        // Отображение основных планет
        for (const planet of this.constants.PLANETS) {
            const data = positions[planet.id];
            if (!data) continue;
            
            this.createPlanetCard(container, planet, data);
        }
        
        // Отображение дополнительных объектов
        for (const obj of this.constants.EXTRA_OBJECTS) {
            const data = positions[obj.id];
            if (!data) continue;
            
            this.createPlanetCard(container, obj, data);
        }
    }
    
    createPlanetCard(container, planet, data) {
        const zodiac = this.getZodiacSign(data.longitude);
        
        const planetCard = document.createElement('div');
        planetCard.className = 'planet-card';
        planetCard.innerHTML = `
            <div class="planet-header">
                <div class="planet-symbol" style="color: ${planet.color}">
                    ${planet.symbol}
                </div>
                <div class="planet-name">${planet.name}</div>
            </div>
            <div class="planet-position" style="color: ${planet.color}">
                ${zodiac.degree}° ${zodiac.minute}' ${zodiac.second}"
                ${data.isRetrograde ? '<span class="retrograde" style="font-size: 12px; margin-left: 5px;">R</span>' : ''}
            </div>
            <div class="planet-zodiac zodiac-${zodiac.name.toLowerCase()}">
                ${zodiac.symbol} ${zodiac.name}
            </div>
        `;
        
        container.appendChild(planetCard);
    }
    
    // Отображение домов
    displayHouses(houses, system) {
        const container = document.getElementById('natalHouses');
        container.innerHTML = '';
        
        // Отображение всех 12 домов
        for (let i = 1; i <= 12; i++) {
            const cusp = houses.houses[i - 1];
            const zodiac = this.getZodiacSign(cusp);
            
            const houseCard = document.createElement('div');
            houseCard.className = 'house-card';
            houseCard.innerHTML = `
                <div class="house-info">
                    <div class="house-number">${this.constants.HOUSE_NAMES[i]}</div>
                    <div class="house-position">
                        ${zodiac.degree}° ${zodiac.symbol}
                    </div>
                </div>
                <div class="house-zodiac zodiac-${zodiac.name.toLowerCase()}">
                    ${zodiac.name}
                </div>
            `;
            
            container.appendChild(houseCard);
        }
        
        // Отображение углов карты
        const anglesCard = document.createElement('div');
        anglesCard.className = 'house-card';
        anglesCard.innerHTML = `
            <div class="house-info">
                <div class="house-number">УГЛЫ КАРТЫ</div>
                <div class="house-position">
                    ASC: ${this.formatPosition(houses.ascendant)}<br>
                    MC: ${this.formatPosition(houses.mc)}
                </div>
            </div>
        `;
        container.appendChild(anglesCard);
    }
    
    // Форматирование позиции
    formatPosition(longitude) {
        const zodiac = this.getZodiacSign(longitude);
        return `${zodiac.degree}° ${zodiac.symbol}`;
    }
    
    // Расчет аспектов
    calculateAspects(positions) {
        const aspects = [];
        const planetIds = Object.keys(positions);
        
        for (let i = 0; i < planetIds.length; i++) {
            for (let j = i + 1; j < planetIds.length; j++) {
                const p1Id = planetIds[i];
                const p2Id = planetIds[j];
                const p1 = positions[p1Id];
                const p2 = positions[p2Id];
                
                if (!p1 || !p2) continue;
                
                const lon1 = p1.longitude;
                const lon2 = p2.longitude;
                
                // Проверка всех аспектов
                for (const aspect of this.constants.ASPECTS) {
                    const distance = Math.abs(lon1 - lon2);
                    const normalizedDist = distance > 180 ? 360 - distance : distance;
                    const orb = Math.abs(normalizedDist - aspect.angle);
                    
                    if (orb <= aspect.orb) {
                        // Находим названия планет
                        const planet1 = this.constants.PLANETS.find(p => p.id === p1Id) || 
                                      this.constants.EXTRA_OBJECTS.find(p => p.id === p1Id);
                        const planet2 = this.constants.PLANETS.find(p => p.id === p2Id) || 
                                      this.constants.EXTRA_OBJECTS.find(p => p.id === p2Id);
                        
                        if (planet1 && planet2) {
                            aspects.push({
                                planet1: planet1.name,
                                planet2: planet2.name,
                                aspect: aspect.name,
                                angle: aspect.angle,
                                distance: normalizedDist,
                                orb: orb,
                                exact: orb < 1,
                                color: aspect.color
                            });
                        }
                    }
                }
            }
        }
        
        // Сортировка по орбу
        aspects.sort((a, b) => a.orb - b.orb);
        
        // Применение фильтра
        const filter = document.getElementById('aspectFilter').value;
        let filteredAspects = aspects;
        
        if (filter === 'major') {
            filteredAspects = aspects.filter(a => a.orb <= 8);
        } else if (filter === 'exact') {
            filteredAspects = aspects.filter(a => a.exact);
        }
        
        this.displayAspects(filteredAspects);
    }
    
    // Отображение аспектов
    displayAspects(aspects) {
        const container = document.getElementById('aspectsAnalysis');
        
        if (aspects.length === 0) {
            container.innerHTML = '<div class="loading-text">Нет аспектов в пределах орбисов</div>';
            return;
        }
        
        let html = '<div class="form-grid">';
        
        aspects.slice(0, 20).forEach(aspect => {
            html += `
                <div class="form-group">
                    <div style="background: rgba(74, 144, 226, 0.1); padding: 12px; border-radius: 8px; border-left: 4px solid ${aspect.color}">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <strong>${aspect.planet1} - ${aspect.planet2}</strong>
                            <span class="${aspect.exact ? 'accuracy-badge' : ''}" style="font-size: 11px;">
                                ${aspect.exact ? 'Точный' : ''}
                            </span>
                        </div>
                        <div style="color: ${aspect.color}; font-weight: 600;">${aspect.aspect}</div>
                        <div style="font-size: 12px; color: var(--text-secondary); margin-top: 5px;">
                            Угол: ${aspect.angle}° | Факт: ${aspect.distance.toFixed(2)}° | Орб: ${aspect.orb.toFixed(2)}°
                        </div>
                    </div>
                </div>
            `;
        });
        
        html += '</div>';
        
        if (aspects.length > 20) {
            html += `<div style="text-align: center; margin-top: 15px; color: var(--text-secondary);">
                ... и еще ${aspects.length - 20} аспектов
            </div>`;
        }
        
        container.innerHTML = html;
    }
    
    // Расчет эфемерид
    async calculateEphemeris() {
        try {
            document.getElementById('ephemLoading').style.display = 'flex';
            
            const date = document.getElementById('ephemDate').value;
            const time = document.getElementById('ephemTime').value;
            const planet = document.getElementById('ephemPlanet').value;
            const days = parseInt(document.getElementById('ephemDays').value);
            
            const baseDate = new Date(`${date}T${time}Z`);
            const tbody = document.getElementById('ephemerisBody');
            tbody.innerHTML = '';
            
            // Расчет для указанного количества дней
            for (let day = 0; day < Math.min(days, 30); day++) {
                const currentDate = new Date(baseDate.getTime() + day * 86400000);
                const jd = this.dateToJulian(currentDate);
                
                if (planet === 'all') {
                    // Расчет всех планет
                    for (const p of this.constants.PLANETS) {
                        const result = this.calculatePlanetPosition(p.id, jd);
                        const zodiac = this.getZodiacSign(result.longitude);
                        
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${currentDate.toISOString().split('T')[0]}</td>
                            <td>${p.name}</td>
                            <td>${result.longitude.toFixed(4)}°</td>
                            <td class="zodiac-${zodiac.name.toLowerCase()}">${zodiac.symbol}</td>
                            <td style="color: ${result.isRetrograde ? '#FF3B30' : '#4CD964'}">
                                ${result.speed.toFixed(4)}°/день
                                ${result.isRetrograde ? ' R' : ''}
                            </td>
                            <td>${result.isRetrograde ? 'Ретроградное' : 'Директное'}</td>
                        `;
                        tbody.appendChild(row);
                    }
                } else {
                    // Конкретная планета
                    const p = this.constants.PLANETS.find(p => p.id === planet);
                    if (p) {
                        const result = this.calculatePlanetPosition(p.id, jd);
                        const zodiac = this.getZodiacSign(result.longitude);
                        
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${currentDate.toISOString().split('T')[0]}</td>
                            <td>${p.name}</td>
                            <td>${result.longitude.toFixed(4)}°</td>
                            <td class="zodiac-${zodiac.name.toLowerCase()}">${zodiac.symbol}</td>
                            <td style="color: ${result.isRetrograde ? '#FF3B30' : '#4CD964'}">
                                ${result.speed.toFixed(4)}°/день
                                ${result.isRetrograde ? ' R' : ''}
                            </td>
                            <td>${result.isRetrograde ? 'Ретроградное' : 'Директное'}</td>
                        `;
                        tbody.appendChild(row);
                    }
                }
            }
            
        } catch (error) {
            console.error('Error calculating ephemeris:', error);
            this.showError(`Ошибка расчета эфемерид: ${error.message}`);
        } finally {
            document.getElementById('ephemLoading').style.display = 'none';
        }
    }
    
    // Загрузка настроек
    loadSettings() {
        try {
            const settings = JSON.parse(localStorage.getItem('astroProSettings') || '{}');
            
            if (settings.calcAlgorithm) {
                document.getElementById('calcAlgorithm').value = settings.calcAlgorithm;
            }
            if (settings.calcPrecision) {
                document.getElementById('calcPrecision').value = settings.calcPrecision;
            }
            if (settings.ephemRange) {
                document.getElementById('ephemRange').value = settings.ephemRange;
            }
            if (settings.colorScheme) {
                document.getElementById('colorScheme').value = settings.colorScheme;
            }
            if (settings.interfaceLanguage) {
                document.getElementById('interfaceLanguage').value = settings.interfaceLanguage;
            }
        } catch (error) {
            console.error('Error loading settings:', error);
        }
    }
    
    // Сохранение настроек
    saveSettings() {
        try {
            const settings = {
                calcAlgorithm: document.getElementById('calcAlgorithm').value,
                calcPrecision: document.getElementById('calcPrecision').value,
                ephemRange: document.getElementById('ephemRange').value,
                colorScheme: document.getElementById('colorScheme').value,
                interfaceLanguage: document.getElementById('interfaceLanguage').value,
                exportFormat: document.getElementById('exportFormat').value,
                savedAt: new Date().toISOString()
            };
            
            localStorage.setItem('astroProSettings', JSON.stringify(settings));
            
            // Показ сообщения об успешном сохранении
            const modal = document.getElementById('detailModal');
            modal.innerHTML = `
                <div class="modal-content">
                    <h3 style="margin-bottom: 15px; color: var(--accent-light);">
                        <i class="fas fa-check-circle" style="color: #4cd964;"></i> Настройки сохранены
                    </h3>
                    <p style="margin-bottom: 20px; color: var(--text-secondary);">
                        Настройки успешно сохранены и применены.
                    </p>
                    <button class="btn" onclick="document.getElementById('detailModal').classList.remove('active')">
                        Закрыть
                    </button>
                </div>
            `;
            modal.classList.add('active');
            
        } catch (error) {
            console.error('Error saving settings:', error);
            this.showError('Ошибка сохранения настроек');
        }
    }
    
    // Сброс настроек
    resetSettings() {
        if (confirm('Вы уверены, что хотите сбросить все настройки к значениям по умолчанию?')) {
            localStorage.removeItem('astroProSettings');
            location.reload();
        }
    }
}

// Инициализация при загрузке страницы
document.addEventListener('DOMContentLoaded', () => {
    window.astroPro = new ProfessionalAstroCalculator();
    
    // Автоматический расчет при загрузке
    setTimeout(() => {
        window.astroPro.calculateNatalChart();
    }, 500);
});
    </script>
    
    <!-- Font Awesome -->
    <script>
        document.head.insertAdjacentHTML('beforeend', `
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
        `);
    </script>
</body>
</html>
